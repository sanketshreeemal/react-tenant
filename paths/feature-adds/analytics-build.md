# Analytics Dashboard Implementation Documentation

## Overview
This document provides details about the implementation of the Analytics Dashboard feature in the property management application. The analytics dashboard provides landlords with visualizations and metrics to track the performance of their property portfolios.

## Files Changed
1. `src/app/dashboard/analytics/page.tsx` - Main analytics dashboard page

## Implementation Details

### Data Fetching
The analytics dashboard utilizes the following functions from `src/lib/firebase/firestoreUtils.ts` to fetch data from Firebase:

- `getAllRentalInventory()` - Retrieves all rental units in the portfolio
- `getAllLeases()` - Retrieves all leases (historical and current)
- `getAllActiveLeases()` - Retrieves only currently active leases
- `getAllRentPayments()` - Retrieves rent payment history

### Key Metrics Calculated

1. **Occupancy Rate**
   - Calculated as the percentage of total units that are currently occupied
   - Formula: `(occupiedUnits / totalUnits) * 100`

2. **Monthly Revenue**
   - Sum of rent amounts from all active leases
   - Formula: `activeLeases.reduce((sum, lease) => sum + lease.rentAmount, 0)`

3. **Foregone Rent**
   - Potential rent lost due to vacant units
   - For each vacant unit, we find the most recent lease or use the default rent amount

4. **Collection Rate**
   - Percentage of expected rent that was actually collected
   - Formula: `(collectedRent / expectedRent) * 100`

### Chart Visualizations

1. **Occupancy Trends**
   - Stacked bar chart showing occupancy rate vs. vacancy rate (totaling 100%)
   - Green represents occupied units, red represents vacant units
   - Data is generated for the selected time period (3 months, 6 months, 1 year, or all time)

2. **Rent Collection**
   - Combined chart showing:
     - Bar chart comparing expected rent vs. collected rent
     - Line chart showing foregone rent due to vacancies
   - Visualizes monthly financial performance

### Monthly Performance Table
The dashboard includes a detailed table showing monthly performance data:
- Month
- Occupied Units
- Vacant Units
- Occupancy Rate (with visual indicator)
- Expected Rent
- Collected Rent
- Collection Rate (with color-coded visual indicator)

## Technical Implementation

### Libraries Used
- **date-fns** - For date manipulation and formatting
- **recharts** - For creating responsive charts
- **Tailwind CSS** - For styling the UI components

### Data Processing Logic
1. Data is fetched from Firebase using the utility functions
2. Metrics are calculated based on the fetched data
3. Historical data is generated by analyzing leases and payments for each month in the selected time range
4. Chart data is prepared in the format required by the Recharts library

## Future Enhancements
1. Add filtering options to view analytics for specific properties
2. Implement export functionality to download reports as PDF or Excel
3. Add additional charts for deeper analysis (e.g., tenant turnover, maintenance costs)
4. Implement year-over-year comparisons 